<!DOCTYPE html>
<html data-ember-extension="1" lang="pt">

<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="css/app.css" rel="stylesheet">
	<title>
		Cadastro de Grupo - Impacta OPE
	</title>
</head>

<body data-ma-theme="indigo">
	<main class="main">

		<header class="header">
			<div class="navigation-trigger hidden-xl-up" data-ma-action="aside-open" data-ma-target=".sidebar2">
				<div class="navigation-trigger__inner">
					<i class="navigation-trigger__line"></i>
					<i class="navigation-trigger__line"></i>
					<i class="navigation-trigger__line"></i>
				</div>
			</div>

			<div class="header__logo">
				<a href="http://localhost:8000/"><img id="img" src="Cadastro%20de%20Grupo%20-%20Impacta%20OPE_arquivos/logo-faculdade-branco.png"></a>
			</div>

			<ul class="top-nav">
				<li class="dropdown hidden-xs-down">



					<a href="http://localhost:8000/login">
						<i class="zmdi zmdi-account"></i>
						Entrar
					</a>


					<div class="dropdown-menu dropdown-menu-right">

					</div>

				</li>
			</ul>

			<ul class="top-menu top-menu-lg visible-lg-up visible-md-up hidden-sm-down hidden-xs-down">
				<li><a href="">Home</a></li>
				<li><a href="">Trabalhos</a></li>
				<li><a href="">Ajuda</a></li>
			</ul>
		</header>

		<aside class="sidebar2">
			<div class="scrollbar-inner">
				<div class="user">



					<li class="user__info">
						<a href="http://localhost:8000/login">
							<i class="zmdi zmdi-account"></i>
							Entrar
						</a>
					</li>

					<div class="dropdown-menu dropdown-menu-right">

					</div>

				</div>
				<ul class="navigation">
					<li><a href="http://localhost:8000/"><i class="zmdi zmdi-view-list"></i>Home</a></li>
					<li><a href=""><i class="zmdi zmdi-view-list"></i>Trabalhos</a></li>
					<li><a href=""><i class="zmdi zmdi-view-list"></i>Ajuda</a></li>
				</ul>
			</div>
		</aside>


	</main>

	<section class="content" style="padding:102px 30px 0 30px; margin-left:0px">
		<div class="content__inner">
			<main class="main">

				<section class="container">
					<form action="/grupo/" method="POST">

						<input name="csrfmiddlewaretoken" value="1YWO5AeKYgeFYz8dIESykWH1mhybtBR1Ck8MvZLVSATXdYjvWC3sFIiBa7CbvUSH" type="hidden">
						<div class="content__inner">
							<header class="content__title">
								<h1>Cadastro do grupo</h1>
								<small>Insira as informações sobre seu grupo e os integrantes, em seguinda aguarde a aprovação por email para acessar
									a plataforma!</small>
							</header>

							<div class="card">
								<div class="card-body">
									<div class="row">
										<div class="col-sm-6">
											<div class="form-group">
												<input name="nome" class="form-control js-obrigatorio" placeholder="Nome do grupo" value="asdsdsa" type="text">
												<div class="invalid-feedback">
													Nome do grupo é obrigatório.
												</div>
												<i class="form-group__bar"></i>
											</div>
										</div>
										<div class="col-sm-6">
											<div class="form-group">
												<input name="tema" class="form-control js-obrigatorio" placeholder="Tema" value="asdadsada" type="text">
												<div class="invalid-feedback">
													Tema do grupo é obrigatório.
												</div>
												<i class="form-group__bar"></i>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-sm-6">
											<div class="form-group">
												<div class="select">
													<select name="curso" class="form-control js-obrigatorio js-cursos" placeholder="Curso">
														<option></option>

														<option value="1" selected="selected">Análise e Desenvolvimento de Sistemas</option>

													</select>
													<div class="invalid-feedback">
														Curso é obrigatório.
													</div>
													<i class="form-group__bar"></i>
												</div>
											</div>
										</div>
										<div class="col-sm-6">
											<div class="form-group">
												<div class="select">
													<select name="turma" class="form-control js-obrigatorio js-turmas" placeholder="Turma">


													</select>
													<div class="invalid-feedback">
														Turma é obrigatório.
													</div>
													<i class="form-group__bar"></i>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<section id="sec-integrantes" data-quantia="0" class="js-integrates">
							<div id="card-0" class="card profile">
								<div class="actions">
								</div>
								<div class="profile__img">
									<img src="Cadastro%20de%20Grupo%20-%20Impacta%20OPE_arquivos/2.jpg" alt="">
									<a class="zmdi zmdi-camera profile__img__edit"></a>
								</div>
								<div class="profile__info">
									<h3 class="card-body__title">1º Integrante</h3>
									<div class="col-sm-10">
										<div class="row">
											<div class="col-sm-6">
												<div class="form-group">
													<input name="alunos[0].nome" class="form-control js-obrigatorio" placeholder="Nome" type="text">
													<div class="invalid-feedback">
														Nome do integrante é obrigatório.
													</div>
													<i class="form-group__bar"></i>
												</div>
											</div>
											<div class="col-sm-6">
												<div class="form-group">
													<input name="alunos[0].ra" class="form-control js-obrigatorio" placeholder="RA" type="number">
													<div class="invalid-feedback">
														RA é obrigatório.
													</div>
													<i class="form-group__bar"></i>
												</div>
											</div>
											<div class="col-sm-6">
												<div class="form-group">
													<input name="alunos[0].email" class="form-control js-obrigatorio" placeholder="Email" type="email">
													<div class="invalid-feedback">
														Email é obrigatório.
													</div>
													<i class="form-group__bar"></i>
												</div>
											</div>
											<div class="col-sm-6">
												<div class="form-group">
													<input name="alunos[0].telefone" class="form-control" placeholder="Telefone" type="number">
													<i class="form-group__bar"></i>
												</div>
											</div>

										</div>
									</div>
								</div>
							</div>
						</section>
						<div class="card">
							<div class="card-body">
								<div class="d-flex justify-content-between flex-wrap">
									<button id="btn-add-aluno" class="btn btn-info btn--icon-text mt-auto" type="button" style="margin:1em"><i class="zmdi zmdi-account-o"></i>Adicionar
										outro integrante</button>
									<button class="btn btn-success btn--icon-text mt-auto js-btn-finalizar" type="button" style="margin:1em"><i class="zmdi zmdi-check"></i>Finalizar</button>
								</div>
							</div>
						</div>
					</form>
				</section>
			</main>
		</div>

	</section>

	<script src="js/jquery/dist/jquery.min.js"></script>
	<script src="js/popper.js/dist/umd/popper.min.js"></script>
	<script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="js/jquery.scrollbar/jquery.scrollbar.min.js"></script>
	<script src="js/jquery-scrollLock/jquery-scrollLock.min.js"></script>
	<script src="js/app.min.js"></script>
	<script src="js/main.js"></script>

	<script>

		function validarFormulario(form) {
			var inputs = form.find(".js-obrigatorio");

			//busca o valor de todos inputs e verifica se algum possui valor nulo ou em branco
			inputs.each(function (index, input) {
				if ($(input).val() == null || $(input).val() == "") {
					$(input).addClass("is-invalid");
					$(input).removeClass("is-valid");
				} else {
					$(input).addClass("is-valid");
					$(input).removeClass("is-invalid");
				}
			});

			//se nao possuir nenhum input com a classe is-invalid o formulario é submetido
			if (!$(".is-invalid").length > 0) {
				form.submit();
			}
		}

		function carregarOptionsCurso(selectContainer, cursoId) {
			selectContainer.empty();

			var resposta = $.ajax({
				headers:
					{ 'X-CSRFToken': '1YWO5AeKYgeFYz8dIESykWH1mhybtBR1Ck8MvZLVSATXdYjvWC3sFIiBa7CbvUSH' },
				url: '/api/turmas/?cursoId=' + cursoId,
				method: 'GET',
				scriptCharset: "utf-8",
			});

			resposta.done(function (data) {
				$.each(data.turmas, function (key, turma) {
					selectContainer.append(`<option value="` + turma.id + `">` + turma.semestre + ` - ` + turma.sigla + `</option>`)
				});
			});

			resposta.fail(function (data) {
				//alert(data);
			});

		}


		$(document).ready(function () {

			$(".js-btn-finalizar").click(function () {
				var form = $(this).closest("form");
				validarFormulario(form);
			});

			$(".js-cursos").change(function () {
				var cursoId = $(this).val();
				var select = $('.js-turmas');
				carregarOptionsCurso(select, cursoId);
			});

			//carrega turmas se curso ja estiver selecionar na hora de carregar a pagina

			var cursoId = $(".js-cursos").val();
			if (cursoId != null && cursoId != '') {
				carregarOptionsCurso($('.js-turmas'), cursoId);
			}


			var indexAluno = $('#sec-integrantes').data('quantia');
			var containerAlunos = $('#sec-integrantes');
			var btnAddAluno = $('#btn-add-aluno');

			btnAddAluno.click(function () {
				indexAluno = indexAluno + 1;
				var integranteNumero = indexAluno + 1
				var corpoHtml = `<div id="card-0" class="card profile">
								<div class="actions">
										<a  class="actions__item zmdi zmdi-close js-clica-remove-card"></a>
								</div>
								<div class="profile__img">
									<img  src="/static/img/contacts/2.jpg" alt="">
									<a  class="zmdi zmdi-camera profile__img__edit"></a>
								</div>
								<div class="profile__info">
									<h3 class="card-body__title">`+ integranteNumero + `º Integrante</h3>
									<div class="col-sm-10">
										<div class="row">
											<div class="col-sm-6">
												<div class="form-group">
													<input name="alunos[`+ indexAluno + `].nome" type="text" class="form-control" placeholder="Nome"/>
													<div class="invalid-feedback">
														Nome do integrante é obrigatório.
													</div>
													<i class="form-group__bar"></i>
												</div>
											</div>
											<div class="col-sm-6">
												<div class="form-group">
													<input name="alunos[`+ indexAluno + `].ra" type="number" class="form-control js-obrigatorio" placeholder="RA">
													<div class="invalid-feedback">
														RA é obrigatório.
													</div>
													<i class="form-group__bar"></i>
												</div>
											</div>
											<div class="col-sm-6">
												<div class="form-group">
													<input name="alunos[`+ indexAluno + `].email" type="email" class="form-control js-obrigatorio" placeholder="Email">
													<div class="invalid-feedback">
														Email é obrigatório.
													</div>
													<i class="form-group__bar"></i>
												</div>
											</div>
											<div class="col-sm-6">
												<div class="form-group">
													<input name="alunos[`+ indexAluno + `].telefone" type="number" class="form-control" placeholder="Telefone">
													<i class="form-group__bar"></i>
												</div>
											</div>

										</div>
									</div>
								</div>
							</div>`

				containerAlunos.append(corpoHtml);

				$(".js-clica-remove-card").click(function () {
					indexAluno = indexAluno - 1;
					$(this).closest(".card").remove();
				});
			});

		});

	</script>
</body>

</html>